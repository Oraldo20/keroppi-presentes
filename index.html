<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sala do Keroppi ‚Äî Presentes</title>
<style>
:root{
  --bg1:#03021a; --bg2:#0b0b2b; --accent:#ff5a86; --soft:#f7f4ff;
  --pink:#ff9ab8; --blue:#9ad0ff; --lilac:#cfb3ff;
  --present-fill: #fff7fb;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter, Poppins, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:radial-gradient(1200px 600px at 20% 10%, #071033 0%, var(--bg1) 30%, var(--bg2) 100%); color:#fff;}
.stage{width:100%;max-width:980px;margin:0 auto;min-height:100vh;position:relative;overflow:hidden;padding:18px 12px}

/* stars */
.stars{position:absolute;inset:0;pointer-events:none;z-index:10}
.star{position:absolute;background:linear-gradient(180deg,#fff,#ffd7ff);width:3px;height:3px;border-radius:50%;opacity:0.9;box-shadow:0 0 6px rgba(255,255,255,0.4);animation:twinkle 3s infinite ease-in-out;}
@keyframes twinkle{0%{opacity:.2;transform:scale(.6)}50%{opacity:1;transform:scale(1.2)}100%{opacity:.2;transform:scale(.7)}}

/* GRAMA MELHORADA */
.grass{
  position:absolute;left:0;right:0;bottom:0;
  height:22vh;
  background: linear-gradient(180deg, #0a4b2c 0%, #0c6d3f 100%);
  border-top-left-radius:30px;
  border-top-right-radius:30px;
  display:flex;align-items:flex-end;justify-content:center;
  box-shadow: inset 0 10px 18px rgba(0,0,0,0.5), 0 0 20px rgba(7, 64, 34, 0.6);
  z-index: 30;
  overflow: hidden;
}
.grass::before{
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 100%;
  background-image: 
    radial-gradient(circle at 10% 20%, rgba(255,255,255,0.1) 2px, transparent 2px),
    radial-gradient(circle at 30% 40%, rgba(255,255,255,0.1) 2px, transparent 2px),
    radial-gradient(circle at 70% 60%, rgba(255,255,255,0.1) 2px, transparent 2px),
    radial-gradient(circle at 90% 80%, rgba(255,255,255,0.1) 2px, transparent 2px);
  background-size: 100px 100px, 80px 80px, 120px 120px, 90px 90px;
  background-position: 0 0, 30px 30px, 60px 60px, 90px 90px;
}
.grass::after{
  content: '';
  position: absolute;
  left: 0;
  right: 0;
  top: -18px;
  height: 28px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
  filter: blur(6px);
}

/* KEROPPI FEITO COM CSS - CORRE√á√ïES APLICADAS */
.keroppi-wrap{
  position:absolute;
  bottom:10vh;
  left:5%;width:200px;display:flex;flex-direction:column;align-items:center;gap:8px;
  z-index:50; /* AUMENTEI O Z-INDEX PARA FICAR NA FRENTE DOS PRESENTES */
}
.keroppi{
  width:160px;height:160px;
  background:radial-gradient(circle at 35% 30%, #c4ffcc, #63c761);
  border:6px solid #327a30;
  border-radius: 50% / 45%;
  position:relative;
  box-shadow:0 12px 34px rgba(0,0,0,0.45);
  animation: float 4s infinite ease-in-out;
  filter: drop-shadow(0 0 10px rgba(144, 238, 144, 0.5));
}
@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}
.keroppi .eye{
  position:absolute;
  width:28px;
  height:28px;
  background:#fff;
  border-radius:50%;
  top:45px; /* AJUSTEI A POSI√á√ÉO DOS OLHOS */
  border:3px solid #327a30;
  animation: blink 5s infinite;
}
.keroppi .eye.left{left:38px}
.keroppi .eye.right{right:38px}
@keyframes blink {
  0%, 95%, 100% { height: 28px; }
  97% { height: 3px; }
}
.keroppi .pupil{
  position:absolute;
  width:14px;
  height:14px;
  background:#0b0b0b;
  border-radius:50%;
  top:7px;
  left:7px;
}
.keroppi .cheek{
  position:absolute;
  width:32px;
  height:16px;
  background:linear-gradient(180deg,#ffc6d9,#ff93b3);
  border-radius: 16px;
  bottom:50px; /* POSICIONAMENTO CORRIGIDO DAS BOCHEHAS */
}
.keroppi .cheek.left{left:32px}
.keroppi .cheek.right{right:32px}
.keroppi .smile{
  position:absolute;
  left:50%;
  bottom:42px; /* POSI√á√ÉO DO SORRISO CORRIGIDA */
  width:80px;
  height:32px;
  transform:translateX(-50%);
  border-bottom: 5px solid #327a30;
  border-radius: 0 0 40px 40px;
}

/* BAL√ÉO DE FALA */
.speech{
  position:relative;
  background:linear-gradient(180deg,#fff 0%,#fff);
  color:#0b0b0b;
  padding:12px 14px;
  border-radius:12px;
  box-shadow:0 8px 26px rgba(0,0,0,0.5);
  max-width:300px;
  font-size:14px;
  z-index:55; /* Z-INDEX MAIOR QUE O SAPO */
  border: 2px solid #ff9ab8;
  margin-bottom: 10px;
  order: -1;
}
.speech::after{
  content:'';
  position:absolute;
  left: 50%;
  bottom: -12px;
  transform: translateX(-50%);
  border-width: 12px 8px 0 8px;
  border-style: solid;
  border-color: #fff transparent transparent transparent;
}
.speech::before{
  content: '‚ù§ ‚ù§ ‚ù§';
  position: absolute;
  top: -12px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 12px;
  color: #ff6b9a;
  background: #fff;
  padding: 0 8px;
  line-height: 1;
}

/* PRESENTES - Z-INDEX REDUZIDO */
.pile{
  position:absolute;
  left:55%;
  transform:translateX(-50%);
  bottom:14vh;
  width:75%;
  max-width:700px;
  height:44vh;
  pointer-events:auto;
  z-index:40; /* Z-INDEX MENOR QUE O SAPO */
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 0 20px;
}
.present-row {
  display: flex;
  justify-content: center;
  align-items: flex-end;
  width: 100%;
  margin-bottom: 25px;
  gap: 40px;
}
.present-row:last-child {
  margin-bottom: 0;
}
.present{
  position:relative;
  pointer-events:auto;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:8px;
  background:var(--present-fill);
  border:3px solid #ff3b3b;
  box-shadow:0 12px 28px rgba(0,0,0,0.45);
  transition:transform .18s ease;
  overflow:visible;
  cursor: pointer;
  animation: present-shake 8s infinite ease-in-out;
  flex-shrink: 0;
}
@keyframes present-shake {
  0%, 90%, 100% { transform: rotate(0); }
  92% { transform: rotate(2deg); }
  94% { transform: rotate(-2deg); }
  96% { transform: rotate(1deg); }
}
.present .ribbon-v{position:absolute;left:50%;top:0;transform:translateX(-50%);width:12px;height:100%;background:#ff3b3b}
.present .ribbon-h{position:absolute;left:0;top:50%;transform:translateY(-50%);width:100%;height:12px;background:#ff3b3b}
.present .lid{position:absolute;width:calc(100% + 6px);height:18px;background:#ff3b3b;top:-18px;left:-3px;border-radius:6px;transform-origin:10% 50%;transition:transform .4s cubic-bezier(.2,.9,.2,1)}
.present.open .lid{transform:rotate(-33deg) translate(-10px,-6px)}

/* hearts emitter container inside present */
.emitter{position:absolute;left:10%;right:10%;top:10%;bottom:10%;pointer-events:none;overflow:visible}
.heart{position:absolute;width:14px;height:14px;transform:rotate(45deg);opacity:0;}
.heart::before,.heart::after{content:'';position:absolute;background:currentColor;border-radius:50%}
.heart::before{width:14px;height:14px;left:0;top:-8px}
.heart::after{width:14px;height:14px;left:-8px;top:0}
.float{animation:floatUp 1.6s forwards ease-out}
@keyframes floatUp{0%{transform:translateY(0) scale(1) rotate(45deg);opacity:1}100%{transform:translateY(-120px) scale(1.2) rotate(45deg);opacity:0}}

/* center modal message */
.modal-backdrop{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:80;backdrop-filter:blur(6px);background:rgba(1,2,8,0.45);opacity:0;pointer-events:none;transition:opacity .2s}
.modal-backdrop.open{opacity:1;pointer-events:auto}
.modal{background:linear-gradient(180deg,#fff,#fff);color:#081022;border-radius:14px;padding:18px;max-width:92%;width:420px;box-shadow:0 12px 36px rgba(0,0,0,0.6);position:relative}
.modal .corner-heart{position:absolute;font-size:18px}
.modal .ch1{left:-10px;top:-10px;color:var(--pink)}
.modal .ch2{right:-10px;top:-10px;color:var(--blue)}
.modal .ch3{right:-10px;bottom:-10px;color:var(--lilac)}
.modal h3{margin:0 0 8px;font-size:18px}
.modal p{margin:0 0 12px;line-height:1.4}
.close-btn{background:transparent;border:2px solid #222;padding:8px 12px;border-radius:10px;cursor:pointer}

/* colors for modal rotating */
.modal.pink{border-top:6px solid var(--pink)}
.modal.blue{border-top:6px solid var(--blue)}
.modal.lilac{border-top:6px solid var(--lilac)}

/* audio control */
.audio-control{position:absolute;top:14px;right:14px;z-index:90;background:rgba(255,255,255,0.06);padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);backdrop-filter:blur(4px);color:#fff}

/* RESPONSIVE - VERS√ÉO MOBILE CORRIGIDA */
@media(max-width:768px){
  .stage{padding:12px 8px;}
  
  .keroppi-wrap{
    left:2%;
    width:130px;
    bottom: 8vh;
    z-index: 50; /* MANTIVE O Z-INDEX ALTO NO MOBILE */
  }
  .keroppi{
    width:100px;
    height:100px;
  }
  .keroppi .eye{
    width:18px;
    height:18px;
    top:28px; /* AJUSTE PARA MOBILE */
    border:2px solid #327a30;
  }
  .keroppi .eye.left{left:24px}
  .keroppi .eye.right{right:24px}
  .keroppi .pupil{
    width:8px;
    height:8px;
    top:5px;
    left:5px;
  }
  .keroppi .cheek{
    width:20px;
    height:10px;
    bottom:32px; /* AJUSTE MELHOR PARA MOBILE */
  }
  .keroppi .cheek.left{left:20px}
  .keroppi .cheek.right{right:20px}
  .keroppi .smile{
    width:50px;
    height:20px;
    bottom:26px; /* AJUSTE MELHOR PARA MOBILE */
    border-bottom: 3px solid #327a30;
  }
  
  .speech{
    max-width:180px;
    font-size:11px;
    padding:10px 12px;
    margin-bottom: 5px;
    z-index: 55; /* MANTIVE ALTO NO MOBILE */
  }
  
  .pile{
    left:50%;
    width:85%;
    height:50vh;
    bottom: 12vh;
    padding: 0 10px;
    z-index: 40; /* MANTIVE BAIXO NO MOBILE */
  }
  .present-row{
    margin-bottom: 15px;
    gap: 15px;
  }
  .present{
    box-shadow:0 6px 12px rgba(0,0,0,0.4);
  }
  
  .grass{
    height:28vh;
  }
  
  .modal{
    width:95%;
    padding:14px;
  }
  .modal h3{
    font-size:16px;
  }
  .modal p{
    font-size:14px;
  }
  
  .audio-control{
    top:10px;
    right:10px;
    padding:6px;
  }
}

@media(max-width:480px){
  .keroppi-wrap{
    width:110px;
    z-index: 50;
  }
  .keroppi{
    width:90px;
    height:90px;
  }
  .keroppi .eye{
    width:16px;
    height:16px;
    top:25px; /* AJUSTE FINO PARA TELAS PEQUENAS */
  }
  .keroppi .eye.left{left:20px}
  .keroppi .eye.right{right:20px}
  .keroppi .pupil{
    width:7px;
    height:7px;
  }
  .keroppi .cheek{
    width:18px;
    height:9px;
    bottom:28px; /* AJUSTE FINO */
  }
  .keroppi .cheek.left{left:18px}
  .keroppi .cheek.right{right:18px}
  .keroppi .smile{
    width:45px;
    height:18px;
    bottom:24px; /* AJUSTE FINO */
  }
  
  .speech{
    max-width:150px;
    font-size:10px;
    z-index: 55;
  }
  
  .pile{
    width:90%;
    z-index: 40;
  }
  .present-row{
    gap: 10px;
  }
}
</style>

<script defer>
/* Mensagens e dados */
const messages = [
  'eu te adoro',
  'gosto muito de voc√™ e voc√™ me diverte muito',
  'se estiver passando por algo pode falar comigo, sempre vou estar ao seu lado pare te ajudar',
  'adoro seus olhos e acho eles a coisa mais linda do mundo sabia',
  'quero te abra√ßar enquanto comemos bobs, quando isso acontecer vou ser a pessoa mais feliz do mundo',
  'sabia que gosto de voc√™ muit√£o sabia',
  'sou seu duzinho e sempre vou estar com voc√™ at√© nos momentos mais complicados',
  'saiba que voce √© a mulher mais linda e charmosa que eu ja conheci tudo em voc√™ me encanta, suas inseguran√ßas me fazem gostar mais ainda de voc√™, quero poder um dia amar tanto as suas inseguran√ßas que voc√™ vai ate se esqueder delas'
];

const comments = [
  'Que legal!', 
  'Esse √© maneiro!', 
  'hahaha adorei', 
  'Que fofura', 
  'Nossa, que lindo!',
  'Muito fofo!',
  'kkkkkk essa foi boa',
  'Amei isso!',
  'Incr√≠vel!',
  'Que surpresa legal!',
  'Hihihi, que divertido!',
  'Que presente especial!',
  'Isso √© t√£o fofo!',
  'Maravilhoso!',
  'Que demais!',
  'Adorei esse!',
  'Hahaha que engra√ßado!',
  'Que coisa mais fofa!',
  'Nossa, que incr√≠vel!',
  'Que surpresa boa!'
];
const modalColors = ['pink','blue','lilac'];
let openedCount = 0;

function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function makeStars(n=60){
  const s = document.getElementById('stars');
  if(!s) return;
  for(let i=0;i<n;i++){
    const el = document.createElement('div');
    el.className='star';
    const size = Math.random()*2+1;
    el.style.width = size+'px';
    el.style.height = size+'px';
    el.style.left = Math.random()*100+'%';
    el.style.top = Math.random()*60+'%';
    el.style.opacity = Math.random()*0.9+.2;
    el.style.animationDuration = (Math.random()*3+2)+'s';
    s.appendChild(el);
  }
}

const presentSizes = [
  {w: 100, h: 75, type: 'small'}, 
  {w: 120, h: 90, type: 'medium'}, 
  {w: 140, h: 105, type: 'large'}, 
  {w: 90, h: 68, type: 'small'},
  {w: 130, h: 98, type: 'medium'}, 
  {w: 160, h: 120, type: 'large'}, 
  {w: 110, h: 82, type: 'medium'}, 
  {w: 150, h: 112, type: 'large'}
];

function createPresents(){
  const pile = document.getElementById('pile');
  if(!pile) return;

  // limpa antes (√∫til no resize)
  while(pile.firstChild) pile.removeChild(pile.firstChild);

  // mapeia mensagens com tamanho original
  const mapped = messages.map((msg, index) => ({msg, size: presentSizes[index] || presentSizes[0], originalIndex: index}));
  const shuffledMessages = shuffleArray(mapped.slice());

  // Criar as 3 linhas: 3, 3, 2
  const rows = [
    {count: 3, className: 'present-row top-row'},
    {count: 3, className: 'present-row middle-row'}, 
    {count: 2, className: 'present-row bottom-row'}
  ];
  
  let messageIndex = 0;

  for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
    const row = rows[rowIndex];
    const rowElement = document.createElement('div');
    rowElement.className = row.className;
    
    const rowPresents = shuffledMessages.slice(messageIndex, messageIndex + row.count);
    messageIndex += row.count;
    
    // Ordenar por tamanho: grande, m√©dio, pequeno
    const sortedPresents = rowPresents.sort((a, b) => {
      const sizeOrder = {large: 0, medium: 1, small: 2};
      return sizeOrder[a.size.type] - sizeOrder[b.size.type];
    });
    
    for (let i = 0; i < sortedPresents.length; i++) {
      const data = sortedPresents[i];
      const w = data.size.w;
      const h = data.size.h;
      
      const p = document.createElement('div');
      p.className='present';
      p.style.width = w+'px';
      p.style.height = h+'px';
      p.dataset.idx = data.originalIndex;

      const lid = document.createElement('div'); lid.className='lid'; p.appendChild(lid);
      const rv = document.createElement('div'); rv.className='ribbon-v'; p.appendChild(rv);
      const rh = document.createElement('div'); rh.className='ribbon-h'; p.appendChild(rh);
      const emitter = document.createElement('div'); emitter.className='emitter'; p.appendChild(emitter);

      p.addEventListener('click', (e)=>{ openPresent(p); });

      rowElement.appendChild(p);
    }
    
    pile.appendChild(rowElement);
  }
}

function openPresent(p){
  const speech = document.getElementById('speech');
  const modalTitle = document.getElementById('modalTitle');
  const modalText = document.getElementById('modalText');
  const modalBackdrop = document.getElementById('modalBackdrop');
  const modal = document.getElementById('modal');
  if(!p || p.classList.contains('open') || !speech || !modal) return;

  p.classList.add('open');
  openedCount++;

  const emitter = p.querySelector('.emitter');
  for(let i=0;i<10;i++){
    const h = document.createElement('div'); h.className='heart float';
    const colors = ['#ff4d7a','#ff9ad1','#cfa3ff','#9ad6ff'];
    h.style.color = colors[Math.floor(Math.random()*colors.length)];
    h.style.left = (20 + Math.random()*60) + '%';
    h.style.top = (60 + Math.random()*20) + '%';
    emitter.appendChild(h);
    // remove depois da anima√ß√£o
    setTimeout(()=> { if(h && h.parentNode) h.remove(); },1600);
  }

  const idx = parseInt(p.dataset.idx,10) || 0;
  showModal(idx, modalTitle, modalText, modal, modalBackdrop);

  const comment = comments[Math.floor(Math.random()*comments.length)];
  setTimeout(()=> { if(speech) speech.textContent = comment; }, 400);

  if(openedCount === messages.length){
    setTimeout(()=> { if(speech) speech.textContent = 'Nossa, acho que o duzinho merece um selinho na bochecha hein üíöüíã'; }, 900);
  }
}

function showModal(idx, modalTitle, modalText, modal, modalBackdrop){
  if(!modalTitle || !modalText || !modal || !modalBackdrop) return;
  modalTitle.textContent = 'Presente #'+(idx+1);
  modalText.textContent = messages[idx] || '';
  modal.classList.remove('pink','blue','lilac');
  modal.classList.add(modalColors[idx % modalColors.length]);
  modalBackdrop.classList.add('open');
}

function closeModal(){
  const modalBackdrop = document.getElementById('modalBackdrop');
  if(modalBackdrop) modalBackdrop.classList.remove('open');
}

/* Inicializa√ß√£o */
document.addEventListener('DOMContentLoaded', ()=>{
  const closeModalBtn = document.getElementById('closeModal');
  const modalBackdrop = document.getElementById('modalBackdrop');

  if(closeModalBtn && modalBackdrop){
    closeModalBtn.addEventListener('click', closeModal);
    modalBackdrop.addEventListener('click', (e)=>{ if(e.target === modalBackdrop) closeModal(); });
  }

  makeStars(80);
  createPresents();
});

/* redesenha presentes ao redimensionar */
window.addEventListener('resize', ()=>{
  // debounce simples
  clearTimeout(window._createPresentsTimeout);
  window._createPresentsTimeout = setTimeout(()=> {
    createPresents();
  }, 120);
});
</script>
</head>
<body>
<div class="stage" id="stage">
  <div class="stars" id="stars"></div>

  <div class="keroppi-wrap">
    <div class="speech" id="speech">Pode escolher um presente para abrir (mentira pode abrir todos hihi voc√™ merece)</div>
    <div class="keroppi" id="keroppi">
      <div class="eye left"><div class="pupil"></div></div>
      <div class="eye right"><div class="pupil"></div></div>
      <div class="cheek left"></div>
      <div class="cheek right"></div>
      <div class="smile"></div>
    </div>
  </div>

  <div class="pile" id="pile" aria-hidden="false"></div>
  <div class="grass"></div>

  <div class="audio-control">
    <button id="audioToggle" disabled title="M√∫sica temporariamente desativada">üîá M√∫sica</button>
  </div>
</div>

<div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
  <div id="modal" class="modal pink" role="dialog">
    <div class="corner-heart ch1">‚ù§</div>
    <div class="corner-heart ch2">‚ù§</div>
    <div class="corner-heart ch3">‚ù§</div>
    <h3 id="modalTitle">T√≠tulo</h3>
    <p id="modalText">Texto</p>
    <div style="display:flex;justify-content:flex-end"><button id="closeModal" class="close-btn">Fechar</button></div>
  </div>
</div>
</body>
</html>
